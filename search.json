[{"title":"PEæ–‡ä»¶å­¦ä¹ ","url":"/2024/10/30/PEæ–‡ä»¶å­¦ä¹ /","content":"\n## PE æ–‡ä»¶çš„å­¦ä¹ ï¼š\n\n### 1.äº†è§£\n\nPEï¼ˆ Portable Executeï¼‰æ–‡ä»¶æ˜¯Windowsä¸‹å¯æ‰§è¡Œæ–‡ä»¶çš„æ€»ç§°ï¼Œå¸¸è§çš„æœ‰ **DLLï¼ŒEXEï¼ŒOCXï¼ŒSYS** ç­‰ã€‚å®ƒæ˜¯å¾®è½¯åœ¨ UNIX å¹³å°çš„ COFFï¼ˆé€šç”¨å¯¹è±¡æ–‡ä»¶æ ¼å¼ï¼‰åŸºç¡€ä¸Šåˆ¶ä½œè€Œæˆã€‚**æœ€åˆè®¾è®¡ç”¨æ¥æé«˜ç¨‹åºåœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸Šçš„ç§»æ¤æ€§ï¼Œä½†å®é™…ä¸Šè¿™ç§æ–‡ä»¶æ ¼å¼ä»…ç”¨åœ¨ Windows ç³»åˆ—æ“ä½œç³»ç»Ÿä¸‹**ã€‚**PEæ–‡ä»¶æ˜¯æŒ‡ 32 ä½å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¹Ÿç§°ä¸ºPE32ã€‚64ä½çš„å¯æ‰§è¡Œæ–‡ä»¶ç§°ä¸º PE+ æˆ– PE32+ï¼Œæ˜¯PE(PE32)çš„ä¸€ç§æ‰©å±•å½¢å¼ï¼ˆè¯·æ³¨æ„ä¸æ˜¯PE64)**ã€‚\n\näº‹å®ä¸Šï¼Œ**ä¸€ä¸ªæ–‡ä»¶æ˜¯å¦æ˜¯ PE æ–‡ä»¶ä¸å…¶æ‰©å±•åæ— å…³**ï¼ŒPEæ–‡ä»¶å¯ä»¥æ˜¯ä»»ä½•æ‰©å±•åã€‚é‚£ Windows æ˜¯æ€ä¹ˆåŒºåˆ†å¯æ‰§è¡Œæ–‡ä»¶å’Œéå¯æ‰§è¡Œæ–‡ä»¶çš„å‘¢ï¼Ÿæˆ‘ä»¬è°ƒç”¨ LoadLibrary ä¼ é€’äº†ä¸€ä¸ªæ–‡ä»¶åï¼Œ**ç³»ç»Ÿæ˜¯å¦‚ä½•åˆ¤æ–­è¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªåˆæ³•çš„åŠ¨æ€åº“å‘¢ï¼Ÿè¿™å°±æ¶‰åŠåˆ°PEæ–‡ä»¶ç»“æ„äº†ã€‚**\n\n![](PEæ–‡ä»¶å­¦ä¹ /2.png)\n\n### 2.ç»“æ„å­¦ä¹ \n\n### ä¸€ã€DOSå¤´\n\nDOSå¤´ çš„ä½œç”¨æ˜¯å…¼å®¹ MS-DOS æ“ä½œç³»ç»Ÿä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¯¹äº 32ä½PEæ–‡ä»¶æ¥è¯´ï¼ŒDOS æ‰€èµ·çš„ä½œç”¨å°±æ˜¯æ˜¾ç¤ºä¸€è¡Œæ–‡å­—ï¼Œæç¤ºç”¨æˆ·ï¼šæˆ‘éœ€è¦åœ¨32ä½windowsä¸Šæ‰å¯ä»¥è¿è¡Œã€‚æˆ‘è®¤ä¸ºè¿™æ˜¯ä¸ªå–„æ„çš„ç©ç¬‘ï¼Œå› ä¸ºä»–å¹¶ä¸åƒæ˜¾ç¤ºçš„é‚£æ ·ä¸èƒ½è¿è¡Œï¼Œå…¶å®å·²ç»è¿è¡Œäº†ï¼Œåªæ˜¯åœ¨ DOS ä¸Šæ²¡æœ‰å¹²ç”¨æˆ·å¸Œæœ›çœ‹åˆ°çš„å·¥ä½œè€Œå·²ï¼Œå¥½å§ï¼Œæˆ‘æ‰¿è®¤è¿™ä¸æ˜¯é‡ç‚¹ã€‚ä½†æ˜¯ï¼Œè‡³å°‘æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸ªå¤´æ˜¯å¦‚ä½•å®šä¹‰çš„ï¼š\n\n```c\ntypedef struct _IMAGE_DOS_HEADER {      // DOS .EXE header\n    WORD   e_magic;                     // Magic number\n    WORD   e_cblp;                      // Bytes on last page of file\n    WORD   e_cp;                        // Pages in file\n    WORD   e_crlc;                      // Relocations\n    WORD   e_cparhdr;                   // Size of header in paragraphs\n    WORD   e_minalloc;                  // Minimum extra paragraphs needed\n    WORD   e_maxalloc;                  // Maximum extra paragraphs needed\n    WORD   e_ss;                        // Initial (relative) SS value\n    WORD   e_sp;                        // Initial SP value\n    WORD   e_csum;                      // Checksum\n    WORD   e_ip;                        // Initial IP value\n    WORD   e_cs;                        // Initial (relative) CS value\n    WORD   e_lfarlc;                    // File address of relocation table\n    WORD   e_ovno;                      // Overlay number\n    WORD   e_res[4];                    // Reserved words\n    WORD   e_oemid;                     // OEM identifier (for e_oeminfo)\n    WORD   e_oeminfo;                   // OEM information; e_oemid specific\n    WORD   e_res2[10];                  // Reserved words\n    LONG   e_lfanew;                    // File address of new exe header\n  } IMAGE_DOS_HEADER, *PIMAGE_DOS_HEADER;\n```\n\n![](PEæ–‡ä»¶å­¦ä¹ /1.png)\n\n### äºŒã€NTå¤´\n\né¡ºç€ DOS å¤´ä¸­çš„ **e_lfanew**ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å¯ä»¥æ‰¾åˆ° **NTå¤´ï¼Œè¿™ä¸ªæ‰æ˜¯ 32ä½PEæ–‡ä»¶ä¸­æœ€æœ‰ç”¨çš„å¤´**ï¼Œå®šä¹‰å¦‚ä¸‹:\n\n```C\ntypedef struct _IMAGE_NT_HEADERS {\n    DWORD Signature;\n    IMAGE_FILE_HEADER FileHeader;\n    IMAGE_OPTIONAL_HEADER32 OptionalHeader;\n} IMAGE_NT_HEADERS32, *PIMAGE_NT_HEADERS32;\n```\n\n##### 1.Signature\n\nç±»ä¼¼äº DOSå¤´ä¸­çš„ e_magicï¼Œå…¶é«˜16ä½æ˜¯0ï¼Œä½16æ˜¯0x4550ï¼Œç”¨å­—ç¬¦è¡¨ç¤ºæ˜¯ 'PEâ€˜ ã€‚â­â­â­\n\n##### 2.IMAGE_FILE_HEADER(æ–‡ä»¶å¤´)\n\n```c\ntypedef struct _IMAGE_FILE_HEADER {\n    WORD    Machine;\n    WORD    NumberOfSections;â­â­â­\n    DWORD   TimeDateStamp;\n    DWORD   PointerToSymbolTable;\n    DWORD   NumberOfSymbols;\n    WORD    SizeOfOptionalHeader;\n    WORD    Characteristics;\n} IMAGE_FILE_HEADER, *PIMAGE_FILE_HEADER;\n```\n\nMachineï¼šè¯¥æ–‡ä»¶çš„è¿è¡Œå¹³å°ï¼Œæ˜¯ x86ã€x64 è¿˜æ˜¯ I64 ç­‰ç­‰ï¼›\n\n<u>NumberOfSectionsï¼š   è¯¥PEæ–‡ä»¶ä¸­æœ‰å¤šå°‘ä¸ªèŠ‚ï¼Œä¹Ÿå°±æ˜¯èŠ‚è¡¨ä¸­çš„é¡¹æ•°ã€‚</u>\nTimeDateStampï¼š      PEæ–‡ä»¶çš„åˆ›å»ºæ—¶é—´ï¼Œä¸€èˆ¬æœ‰è¿æ¥å™¨å¡«å†™ã€‚\nPointerToSymbolTableï¼š COFFæ–‡ä»¶ç¬¦å·è¡¨åœ¨æ–‡ä»¶ä¸­çš„åç§»ã€‚\nNumberOfSymbolsï¼š    ç¬¦å·è¡¨çš„æ•°é‡ã€‚\nSizeOfOptionalHeaderï¼š ç´§éšå…¶åçš„å¯é€‰å¤´çš„å¤§å°ã€‚\nCharacteristicsï¼š       å¯æ‰§è¡Œæ–‡ä»¶çš„å±æ€§\n\n##### 3.IMAGE_OPTIONAL_HEADER(å¯é€‰å¤´)\n\n***åˆ«çœ‹ä»–åå­—å«å¯é€‰å¤´ï¼Œå…¶å®ä¸€ç‚¹éƒ½ä¸èƒ½å°‘ï¼Œä¸è¿‡ï¼Œå®ƒåœ¨ä¸åŒçš„å¹³å°ä¸‹æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¾‹å¦‚32ä½ä¸‹æ˜¯IMAGE_OPTIONAL_HEADER32ï¼Œè€Œåœ¨64ä½ä¸‹æ˜¯IMAGE_OPTIONAL_HEADER64ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬åªçœ‹32ä½ã€‚***\n\n```C\ntypedef struct _IMAGE_OPTIONAL_HEADER {\n    WORD    Magic;\n    BYTE    MajorLinkerVersion;\n    BYTE    MinorLinkerVersion;\n    DWORD   SizeOfCode;\n    DWORD   SizeOfInitializedData;\n    DWORD   SizeOfUninitializedData;\n    DWORD   AddressOfEntryPoint;\n    DWORD   BaseOfCode;\n    DWORD   BaseOfData;\n    DWORD   ImageBase;\n    DWORD   SectionAlignment;  â­â­â­\n    DWORD   FileAlignment;  â­â­â­\n    WORD    MajorOperatingSystemVersion;\n    WORD    MinorOperatingSystemVersion;\n    WORD    MajorImageVersion;\n    WORD    MinorImageVersion;\n    WORD    MajorSubsystemVersion;\n    WORD    MinorSubsystemVersion;\n    DWORD   Win32VersionValue;\n    DWORD   SizeOfImage;\n    DWORD   SizeOfHeaders;\n    DWORD   CheckSum;\n    WORD    Subsystem;\n    WORD    DllCharacteristics;\n    DWORD   SizeOfStackReserve;\n    DWORD   SizeOfStackCommit;\n    DWORD   SizeOfHeapReserve;\n    DWORD   SizeOfHeapCommit;\n    DWORD   LoaderFlags;\n    DWORD   NumberOfRvaAndSizes;\n    IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES];\n} IMAGE_OPTIONAL_HEADER32, *PIMAGE_OPTIONAL_HEADER32;\n```\n\n- **Magic**ï¼šè¡¨ç¤ºå¯é€‰å¤´çš„ç±»å‹ã€‚\n\n  ```C\n  #define IMAGE_NT_OPTIONAL_HDR32_MAGIC      0x10b  // 32ä½PEå¯é€‰å¤´\n  #define IMAGE_NT_OPTIONAL_HDR64_MAGIC      0x20b  // 64ä½PEå¯é€‰å¤´\n  #define IMAGE_ROM_OPTIONAL_HDR_MAGIC       0x107  \n  ```\n\n  \n\n- **MajorLinkerVersion** å’Œ **MinorLinkerVersion**ï¼šé“¾æ¥å™¨çš„ç‰ˆæœ¬å·ã€‚\n\n- **SizeOfCode**ï¼šä»£ç æ®µçš„é•¿åº¦ï¼Œå¦‚æœæœ‰å¤šä¸ªä»£ç æ®µï¼Œåˆ™æ˜¯ä»£ç æ®µé•¿åº¦çš„æ€»å’Œã€‚\n\n- **SizeOfInitializedData**ï¼šåˆå§‹åŒ–çš„æ•°æ®é•¿åº¦ã€‚\n\n- **SizeOfUninitializedData**ï¼šæœªåˆå§‹åŒ–çš„æ•°æ®é•¿åº¦ã€‚\n\n- **AddressOfEntryPointï¼šç¨‹åºå…¥å£çš„ RVAï¼Œå¯¹äºexeè¿™ä¸ªåœ°å€å¯ä»¥ç†è§£ä¸ºWinMainçš„RVAã€‚å¯¹äºDLLï¼Œè¿™ä¸ªåœ°å€å¯ä»¥ç†è§£ä¸ºDllMainçš„RVAï¼Œå¦‚æœæ˜¯é©±åŠ¨ç¨‹åºï¼Œå¯ä»¥ç†è§£ä¸ºDriverEntryçš„RVAã€‚å½“ç„¶ï¼Œå®é™…ä¸Šå…¥å£ç‚¹å¹¶éæ˜¯WinMainï¼ŒDllMainå’ŒDriverEntryï¼Œåœ¨è¿™äº›å‡½æ•°ä¹‹å‰è¿˜æœ‰ä¸€ç³»åˆ—åˆå§‹åŒ–è¦å®Œæˆï¼Œå½“ç„¶ï¼Œè¿™äº›ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ã€‚**â­â­â­\n\n- **BaseOfCode**ï¼šä»£ç æ®µèµ·å§‹åœ°å€çš„RVAã€‚\n\n- **BaseOfData**ï¼šæ•°æ®æ®µèµ·å§‹åœ°å€çš„RVAã€‚\n\n- **ImageBase**ï¼šæ˜ è±¡ï¼ˆåŠ è½½åˆ°å†…å­˜ä¸­çš„PEæ–‡ä»¶ï¼‰çš„åŸºåœ°å€ï¼Œè¿™ä¸ªåŸºåœ°å€æ˜¯å»ºè®®ï¼Œå¯¹äºDLLæ¥è¯´ï¼Œå¦‚æœæ— æ³•åŠ è½½åˆ°è¿™ä¸ªåœ°å€ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºå…¶é€‰æ‹©åœ°å€ã€‚â­â­â­\n\n- **SectionAlignment**ï¼šèŠ‚å¯¹é½ï¼ŒPEä¸­çš„èŠ‚è¢«åŠ è½½åˆ°å†…å­˜æ—¶ä¼šæŒ‰ç…§è¿™ä¸ªåŸŸæŒ‡å®šçš„å€¼æ¥å¯¹é½ï¼Œæ¯”å¦‚è¿™ä¸ªå€¼æ˜¯0x1000ï¼Œé‚£ä¹ˆæ¯ä¸ªèŠ‚çš„èµ·å§‹åœ°å€çš„ä½12ä½éƒ½ä¸º0ã€‚â­â­â­\n\n- **FileAlignment**ï¼šèŠ‚åœ¨æ–‡ä»¶ä¸­æŒ‰æ­¤å€¼å¯¹é½ï¼ŒSectionAlignmentå¿…é¡»å¤§äºæˆ–ç­‰äºFileAlignmentã€‚\n\n- **MajorOperatingSystemVersion**ã€MinorOperatingSystemVersionï¼šæ‰€éœ€æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬å·ï¼Œéšç€æ“ä½œç³»ç»Ÿç‰ˆæœ¬è¶Šæ¥è¶Šå¤šï¼Œè¿™ä¸ªå¥½åƒä¸æ˜¯é‚£ä¹ˆé‡è¦äº†ã€‚\n\n- **MajorImageVersion**ã€**MinorImageVersion**ï¼šæ˜ è±¡çš„ç‰ˆæœ¬å·ï¼Œè¿™ä¸ªæ˜¯å¼€å‘è€…è‡ªå·±æŒ‡å®šçš„ï¼Œç”±è¿æ¥å™¨å¡«å†™ã€‚\n\n- **MajorSubsystemVersion**ã€**MinorSubsystemVersion**ï¼šæ‰€éœ€å­ç³»ç»Ÿç‰ˆæœ¬å·ã€‚\n\n- **Win32VersionValue**ï¼šä¿ç•™ï¼Œå¿…é¡»ä¸º0ã€‚\n\n- **SizeOfImage**ï¼šæ˜ è±¡çš„å¤§å°ï¼ŒPEæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ç©ºé—´æ˜¯è¿ç»­çš„ï¼Œè¿™ä¸ªå€¼æŒ‡å®šå ç”¨è™šæ‹Ÿç©ºé—´çš„å¤§å°ã€‚\n\n- **SizeOfHeaders**ï¼šæ‰€æœ‰æ–‡ä»¶å¤´ï¼ˆåŒ…æ‹¬èŠ‚è¡¨ï¼‰çš„å¤§å°ï¼Œè¿™ä¸ªå€¼æ˜¯ä»¥FileAlignmentå¯¹é½çš„ã€‚\n\n- **CheckSum**ï¼šæ˜ è±¡æ–‡ä»¶çš„æ ¡éªŒå’Œã€‚\n\n- **Subsystem**ï¼šè¿è¡Œè¯¥PEæ–‡ä»¶æ‰€éœ€çš„å­ç³»ç»Ÿã€‚\n\n- **SizeOfStackReserve**ï¼šè¿è¡Œæ—¶ä¸ºæ¯ä¸ªçº¿ç¨‹æ ˆä¿ç•™å†…å­˜çš„å¤§å°ã€‚\n\n- **SizeOfStackCommit**ï¼šè¿è¡Œæ—¶æ¯ä¸ªçº¿ç¨‹æ ˆåˆå§‹å ç”¨å†…å­˜å¤§å°ã€‚\n\n- **SizeOfHeapReserve**ï¼šè¿è¡Œæ—¶ä¸ºè¿›ç¨‹å †ä¿ç•™å†…å­˜å¤§å°ã€‚\n\n- **SizeOfHeapCommit**ï¼šè¿è¡Œæ—¶è¿›ç¨‹å †åˆå§‹å ç”¨å†…å­˜å¤§å°ã€‚\n\n- **LoaderFlags**ï¼šä¿ç•™ï¼Œå¿…é¡»ä¸º0ã€‚\n\n- **NumberOfRvaAndSizes**ï¼šæ•°æ®ç›®å½•çš„é¡¹æ•°ï¼Œå³ä¸‹é¢è¿™ä¸ªæ•°ç»„çš„é¡¹æ•°ã€‚\n\n- â­â­â­â­â­**DataDirectory**ï¼šæ•°æ®ç›®å½•ï¼Œè¿™æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„é¡¹å®šä¹‰å¦‚ä¸‹ï¼š\n\n  ```C\n  typedef struct _IMAGE_DATA_DIRECTORY {\n      DWORD   VirtualAddress; //æ˜¯ä¸€ä¸ªRVAçš„åç§»åœ°å€\n      DWORD   Size; // å¯¹åº”è¡¨çš„å¤§å°\n  } IMAGE_DATA_DIRECTORY, *PIMAGE_DATA_DIRECTORY;\n  ```\n\n  è¿™ä¸¤ä¸ªæ•°æœ‰ä»€ä¹ˆç”¨å‘¢ ï¼Ÿ**ä¸€ä¸ªæ˜¯åœ°å€ï¼Œä¸€ä¸ªæ˜¯å¤§å°ï¼Œå¯ä»¥çœ‹å‡ºè¿™ä¸ªæ•°æ®ç›®å½•é¡¹å®šä¹‰çš„æ˜¯ä¸€ä¸ªåŒºåŸŸ**ã€‚**é‚£ä»–å®šä¹‰çš„æ˜¯ä»€ä¹ˆä¸œè¥¿çš„åŒºåŸŸå‘¢ï¼Ÿ**å‰é¢è¯´äº†ï¼Œ**DataDirectory æ˜¯ä¸ªæ•°ç»„**ï¼Œ**æ•°ç»„ä¸­çš„æ¯ä¸€é¡¹å¯¹åº”ä¸€ä¸ªç‰¹å®šçš„æ•°æ®ç»“æ„**ï¼Œ**åŒ…æ‹¬å¯¼å…¥è¡¨ï¼Œå¯¼å‡ºè¡¨ç­‰ç­‰**ï¼Œ**æ ¹æ®ä¸åŒçš„ç´¢å¼•å–å‡ºæ¥çš„æ˜¯ä¸åŒçš„ç»“æ„**ï¼Œå¤´æ–‡ä»¶é‡Œå®šä¹‰å„ä¸ªé¡¹è¡¨ç¤ºå“ªä¸ªç»“æ„ï¼Œå¦‚ä¸‹é¢çš„ä»£ç æ‰€ç¤º:\n\n```C\n#define IMAGE_DIRECTORY_ENTRY_EXPORT          0   // Export Directory â­â­â­   \n#define IMAGE_DIRECTORY_ENTRY_IMPORT          1   // Import Directory  â­â­â­\n#define IMAGE_DIRECTORY_ENTRY_RESOURCE        2   // Resource Directory\n#define IMAGE_DIRECTORY_ENTRY_EXCEPTION       3   // Exception Directory\n#define IMAGE_DIRECTORY_ENTRY_SECURITY        4   // Security Directory\n#define IMAGE_DIRECTORY_ENTRY_BASERELOC       5   // Base Relocation Table\n#define IMAGE_DIRECTORY_ENTRY_DEBUG           6   // Debug Directory\n//      IMAGE_DIRECTORY_ENTRY_COPYRIGHT       7   // (X86 usage)\n#define IMAGE_DIRECTORY_ENTRY_ARCHITECTURE    7   // Architecture Specific Data\n#define IMAGE_DIRECTORY_ENTRY_GLOBALPTR       8   // RVA of GP\n#define IMAGE_DIRECTORY_ENTRY_TLS             9   // TLS Directory   â­â­\n#define IMAGE_DIRECTORY_ENTRY_LOAD_CONFIG    10   // Load Configuration Directory\n#define IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT   11   // Bound Import Directory in headers\n#define IMAGE_DIRECTORY_ENTRY_IAT            12   // Import Address Table  â­â­  //IAT\n#define IMAGE_DIRECTORY_ENTRY_DELAY_IMPORT   13   // Delay Load Import Descriptors\n#define IMAGE_DIRECTORY_ENTRY_COM_DESCRIPTOR 14   // COM Runtime descriptor\n```\n\n### ä¸‰.IMAGE_SECTION_HEADERï¼ˆèŠ‚è¡¨ï¼‰\n\n```C\ntypedef struct _IMAGE_SECTION_HEADER {\n    Name\t\t\t\t\t\t//8ä¸ªå­—èŠ‚çš„å—å\n    union\t\t\t\t\t\t\n    {\n        DWORD PhysicalAddress;\n        DWORD VirtualSize;\n    } Misc;                     //åŒºå—å°ºå¯¸\n    DWORD VirtualAddress;\t\t//åŒºå—çš„RVAåœ°å€\n    DWORD SizeOfRawData;\t\t//åœ¨æ–‡ä»¶ä¸­å¯¹é½åçš„å°ºå¯¸\n    DWORD PointerToRawData;\t\t//åœ¨æ–‡ä»¶ä¸­åç§»\n    DWORD PointerToRelocations;\t//åœ¨OBJæ–‡ä»¶ä¸­ä½¿ç”¨ï¼Œé‡å®šä½çš„åç§»\n    DWORD PointerToLinenumbers;\t//è¡Œå·è¡¨çš„åç§»ï¼ˆä¾›è°ƒè¯•ä½¿ç”¨åœ°ï¼‰\n    WORD NumberOfRelocations;\t//åœ¨OBJæ–‡ä»¶ä¸­ä½¿ç”¨ï¼Œé‡å®šä½é¡¹æ•°ç›®\n    WORD NumberOfLinenumbers;\t//è¡Œå·è¡¨ä¸­è¡Œå·çš„æ•°ç›®\n    DWORD Characteristics;\t\t//åŒºå—å±æ€§å¦‚å¯è¯»ï¼Œå¯å†™ï¼Œå¯æ‰§è¡Œç­‰\n} IMAGE_SECTION_HEADER, *PIMAGE_SECTION_HEADER;\n```\n\n### å››.èŠ‚\n\næ¯ä¸ªåŒºå—çš„åç§°éƒ½æ˜¯å”¯ä¸€çš„ï¼Œä¸èƒ½æœ‰åŒåçš„ä¸¤ä¸ªåŒºå—ã€‚\nä½†äº‹å®ä¸ŠèŠ‚çš„åç§°ä¸è¡¨ç¤ºä»»ä½•å«ä¹‰ï¼Œä»–çš„å­˜åœ¨ä»…ä»…æ˜¯ä¸ºäº†æ­£è§„ç»Ÿä¸€ç¼–ç¨‹çš„æ—¶å€™æ–¹ä¾¿ç¨‹åºå‘˜æŸ¥çœ‹æ–¹ä¾¿è€Œè®¾ç½®çš„ä¸€ä¸ªæ ‡è®°è€Œå·²ã€‚æ‰€ä»¥å°†åŒ…å«ä»£ç çš„åŒºå—å‘½åä¸ºâ€œ.Dataâ€ ï¼ˆä¸€èˆ¬ä¸º.textï¼‰æˆ–è€…è¯´å°†åŒ…å«æ•°æ®çš„åŒºå—å‘½åä¸ºâ€œ.Codeâ€ï¼ˆä¸€èˆ¬ä¸º.rdataç­‰ï¼‰ éƒ½æ˜¯åˆæ³•çš„ã€‚\nå½“æˆ‘ä»¬è¦ä»PE æ–‡ä»¶ä¸­è¯»å–éœ€è¦çš„åŒºå—çš„æ—¶å€™ï¼Œä¸èƒ½ä»¥åŒºå—çš„åç§°ä½œä¸ºå®šä½çš„æ ‡å‡†å’Œä¾æ®ï¼Œæ­£ç¡®æ–¹æ³•æ˜¯\n\nåœ¨èŠ‚å¤´ï¼ˆ`IMAGE_SECTION_HEADER`ï¼‰ä¸­ã€‚è¦å®šä½èŠ‚çš„åœ°å€ï¼Œä½ å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œï¼š\n\n1. **è·å–æ–‡ä»¶å¤´**ï¼šä» PE æ–‡ä»¶çš„èµ·å§‹éƒ¨åˆ†è¯»å– DOS å¤´ï¼ˆ`IMAGE_DOS_HEADER`ï¼‰ï¼Œç„¶åæ‰¾åˆ° PE å¤´çš„ä½ç½®ã€‚\n2. **è¯»å–å¯é€‰å¤´**ï¼šä» PE å¤´ä¸­è¯»å–å¯é€‰å¤´ï¼ˆ`IMAGE_OPTIONAL_HEADER32`ï¼‰ï¼Œç¡®è®¤æ–‡ä»¶ç±»å‹ï¼ˆå¦‚ PE32ï¼‰ã€‚\n3. **è¯»å–èŠ‚è¡¨**ï¼šå¯é€‰å¤´åé¢ä¼šè·Ÿç€ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚å¤´ã€‚èŠ‚å¤´çš„æ•°é‡åœ¨å¯é€‰å¤´ä¸­æŒ‡å®šï¼Œé€šå¸¸å¯ä»¥é€šè¿‡ `NumberOfSections` å­—æ®µè·å–ã€‚\n4. **è®¡ç®—èŠ‚çš„åœ°å€**ï¼šæ¯ä¸ªèŠ‚å¤´éƒ½æœ‰ä¸€ä¸ª `VirtualAddress` å­—æ®µï¼Œè¡¨ç¤ºè¯¥èŠ‚åœ¨å†…å­˜ä¸­çš„åœ°å€ã€‚ä½ å¯ä»¥é€šè¿‡éå†èŠ‚å¤´æ¥æŸ¥æ‰¾ç‰¹å®šèŠ‚çš„ä¿¡æ¯ã€‚\n5. **åŠ è½½åœ°å€**ï¼šå½“ PE æ–‡ä»¶è¢«åŠ è½½åˆ°å†…å­˜ä¸­æ—¶ï¼Œä½ å¯ä»¥å°† `VirtualAddress` å’ŒåŸºå€ç›¸åŠ ï¼Œä»¥ç¡®å®šèŠ‚çš„å®é™…å†…å­˜åœ°å€ã€‚\n\nå„ç§èŠ‚çš„æè¿°ï¼š\n\n![](PEæ–‡ä»¶å­¦ä¹ /3.png)\n\n### äº”.å…¶ä»–æ³¨æ„\n\n##### 1.RVA å’Œæ–‡ä»¶åç§»æ¢ç®—\n\nåœ¨ PE æ–‡ä»¶æ ¼å¼ä¸­ï¼ŒRVAï¼ˆRelative Virtual Addressï¼‰å’Œæ–‡ä»¶åç§»ä¹‹é—´çš„æ¢ç®—æ˜¯éå¸¸é‡è¦çš„ã€‚ä»¥ä¸‹æ˜¯ç›¸å…³æœ¯è¯­å’Œå®ƒä»¬åœ¨ PE æ–‡ä»¶ç»“æ„ä¸­çš„å®šä¹‰ï¼Œä»¥åŠå¦‚ä½•è¿›è¡Œæ¢ç®—çš„æ–¹æ³•ï¼š\n\n### æœ¯è¯­åŠå…¶å®šä¹‰\n\n1. **RVAï¼ˆRelative Virtual Addressï¼‰**ï¼š\n   - **å®šä¹‰**ï¼šç›¸å¯¹è™šæ‹Ÿåœ°å€ï¼Œæ˜¯æŒ‡æŸä¸ªèŠ‚æˆ–æ•°æ®åœ¨å†…å­˜ä¸­çš„ç›¸å¯¹åœ°å€ï¼Œé€šå¸¸æ˜¯ç›¸å¯¹äºåŠ è½½åŸºå€ï¼ˆ`ImageBase`ï¼‰çš„åç§»ã€‚\n   - **ç»“æ„**ï¼šåœ¨ `IMAGE_SECTION_HEADER` ä¸­çš„ `VirtualAddress` å­—æ®µã€‚\n\n2. **FOAï¼ˆFile Offset Addressï¼‰**ï¼š\n   - **å®šä¹‰**ï¼šæ–‡ä»¶åç§»åœ°å€ï¼ŒæŒ‡çš„æ˜¯æ–‡ä»¶ä¸­æŸä¸ªç‰¹å®šæ•°æ®æˆ–ç»“æ„çš„åç§»ä½ç½®ã€‚\n   - **ç»“æ„**ï¼šåœ¨ `IMAGE_SECTION_HEADER` ä¸­çš„ `PointerToRawData` å­—æ®µã€‚\n\n3. **ImageBase**ï¼š\n   - **å®šä¹‰**ï¼šåŸºå€ï¼ŒæŒ‡ PE æ–‡ä»¶åœ¨å†…å­˜ä¸­åŠ è½½æ—¶çš„èµ·å§‹åœ°å€ã€‚\n   - **ç»“æ„**ï¼šåœ¨ `IMAGE_OPTIONAL_HEADER` ä¸­çš„ `ImageBase` å­—æ®µã€‚\n\n### RVA ä¸ FOA ä¹‹é—´çš„æ¢ç®—\n\n#### 1. ä» RVA è½¬æ¢åˆ° FOA\n\nç»™å®šä¸€ä¸ª RVAï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å…¬å¼è½¬æ¢ä¸º FOAï¼š\n\n```\nFOA = RVA - Section.VirtualAddress + Section.PointerToRawData\n```\n\n- **è§£é‡Š**ï¼š\n  - `Section.VirtualAddress`ï¼šå¯¹åº”èŠ‚å¤´ä¸­çš„ `VirtualAddress` å­—æ®µã€‚\n  - `Section.PointerToRawData`ï¼šå¯¹åº”èŠ‚å¤´ä¸­çš„ `PointerToRawData` å­—æ®µã€‚\n  \n#### 2. ä» FOA è½¬æ¢åˆ° RVA\n\nç»™å®šä¸€ä¸ª FOAï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å…¬å¼è½¬æ¢ä¸º RVAï¼š\n\n```\nRVA = FOA - Section.PointerToRawData + Section.VirtualAddress\n```\n\n### ç¤ºä¾‹\n\nå‡è®¾æœ‰ä»¥ä¸‹èŠ‚å¤´ä¿¡æ¯ï¼š\n\n- **èŠ‚å**ï¼š`.text`\n- **VirtualAddress**ï¼š`0x1000`\n- **PointerToRawData**ï¼š`0x200`\n\né‚£ä¹ˆï¼Œå¯¹äºæŸä¸ªç‰¹å®šçš„ RVA `0x1010`ï¼Œå¯ä»¥è®¡ç®— FOA å¦‚ä¸‹ï¼š\n\n```\nFOA = 0x1010 - 0x1000 + 0x200 = 0x210\n```\n\nå¦‚æœè¦å°† FOA `0x210` è½¬æ¢å› RVAï¼š\n\n```\nRVA = 0x210 - 0x200 + 0x1000 = 0x1010\n```\n\n### æ€»ç»“\n\n- **RVA** æ˜¯èŠ‚åœ¨å†…å­˜ä¸­çš„ç›¸å¯¹è™šæ‹Ÿåœ°å€ã€‚\n- **FOA** æ˜¯èŠ‚åœ¨æ–‡ä»¶ä¸­çš„å…·ä½“åç§»ã€‚\n- ä½¿ç”¨ `IMAGE_SECTION_HEADER` ä¸­çš„ `VirtualAddress` å’Œ `PointerToRawData` å­—æ®µè¿›è¡Œ RVA å’Œ FOA ä¹‹é—´çš„æ¢ç®—ã€‚\n\nè¿™äº›è®¡ç®—åœ¨ PE æ–‡ä»¶çš„è§£æã€è°ƒè¯•å’Œåˆ†æä¸­æ˜¯éå¸¸é‡è¦çš„ï¼Œç†è§£è¿™äº›æœ¯è¯­åŠå…¶å¯¹åº”çš„ç»“æ„å®šä¹‰å°†æœ‰åŠ©äºå¤„ç† PE æ–‡ä»¶æ ¼å¼ã€‚\n\n\n\n**<u>åŒæ—¶è®¡ç®—æ—¶ä¹Ÿè¦è€ƒè™‘å¯¹é½ä¼šå¯¹RVA ä¸ FOA ä¹‹é—´çš„æ¢ç®—å½±å“</u>**\n\nèŠ‚å¯¹é½å’Œæ–‡ä»¶å¯¹é½æ˜¯ PE æ–‡ä»¶æ ¼å¼ä¸­ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œå®ƒä»¬çš„ä¸»è¦åŒºåˆ«å¦‚ä¸‹ï¼š\n\n### èŠ‚å¯¹é½ï¼ˆSection Alignmentï¼‰\n\n1. **å®šä¹‰**ï¼š\n   - èŠ‚å¯¹é½æ˜¯æŒ‡åœ¨ PE æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­æ—¶ï¼ŒèŠ‚åœ¨å†…å­˜ä¸­çš„å¯¹é½è¦æ±‚ã€‚å®ƒå†³å®šäº†æ¯ä¸ªèŠ‚çš„èµ·å§‹åœ°å€å¿…é¡»æ˜¯æŸä¸ªç‰¹å®šå€¼çš„å€æ•°ã€‚\n\n2. **ä½ç½®**ï¼š\n   - èŠ‚å¯¹é½çš„å€¼åœ¨ `IMAGE_OPTIONAL_HEADER` ç»“æ„ä¸­ï¼Œå­—æ®µåç§°ä¸º `SectionAlignment`ã€‚\n\n3. **ä½œç”¨**ï¼š\n   - ç¡®ä¿åŠ è½½åˆ°å†…å­˜ä¸­çš„èŠ‚æŒ‰é¡µå¯¹é½ï¼Œä»¥ä¼˜åŒ–å†…å­˜è®¿é—®å’Œæé«˜æ€§èƒ½ã€‚é€šå¸¸ï¼Œ`SectionAlignment` çš„å€¼ä¸º 4096 å­—èŠ‚ï¼ˆä¸€ä¸ªå†…å­˜é¡µçš„å¤§å°ï¼‰ã€‚\n\n4. **åŠ è½½æ—¶çš„å¯¹é½**ï¼š\n   - èŠ‚å¯¹é½æ˜¯åœ¨ PE æ–‡ä»¶åŠ è½½åˆ°å†…å­˜åç”Ÿæ•ˆçš„ã€‚åŠ è½½è¿‡ç¨‹ä¼šæ ¹æ® `SectionAlignment` è¿›è¡Œè°ƒæ•´ã€‚\n\n### æ–‡ä»¶å¯¹é½ï¼ˆFile Alignmentï¼‰\n\n1. **å®šä¹‰**ï¼š\n   - æ–‡ä»¶å¯¹é½æ˜¯æŒ‡åœ¨ PE æ–‡ä»¶ä¸­ï¼ŒèŠ‚åœ¨æ–‡ä»¶ä¸­çš„å¯¹é½è¦æ±‚ã€‚å®ƒå†³å®šäº†æ¯ä¸ªèŠ‚åœ¨æ–‡ä»¶ä¸­å¼€å§‹çš„ä½ç½®å¿…é¡»æ˜¯æŸä¸ªç‰¹å®šå€¼çš„å€æ•°ã€‚\n\n2. **ä½ç½®**ï¼š\n   - æ–‡ä»¶å¯¹é½çš„å€¼åŒæ ·åœ¨ `IMAGE_OPTIONAL_HEADER` ç»“æ„ä¸­ï¼Œå­—æ®µåç§°ä¸º `FileAlignment`ã€‚\n\n3. **ä½œç”¨**ï¼š\n   - ç¡®ä¿åœ¨ PE æ–‡ä»¶ä¸­ï¼ŒèŠ‚çš„èµ·å§‹ä½ç½®æŒ‰ç…§ `FileAlignment` å¯¹é½ï¼Œä»¥ä¾¿äºæ–‡ä»¶çš„è¯»å–å’Œè§£æã€‚é€šå¸¸ï¼Œ`FileAlignment` çš„å€¼ä¸º 512 å­—èŠ‚æˆ– 4096 å­—èŠ‚ã€‚\n\n4. **æœªåŠ è½½æ—¶çš„å¯¹é½**ï¼š\n   - æ–‡ä»¶å¯¹é½æ˜¯åœ¨ PE æ–‡ä»¶æœªåŠ è½½æ—¶é€‚ç”¨çš„ã€‚å®ƒå½±å“æ–‡ä»¶çš„å­˜å‚¨æ ¼å¼ï¼Œè€Œä¸æ˜¯å†…å­˜ä¸­çš„å¸ƒå±€ã€‚\n\n### æ€»ç»“\n\n- **èŠ‚å¯¹é½**ï¼šé€‚ç”¨äº PE æ–‡ä»¶åŠ è½½åˆ°å†…å­˜åçš„å†…å­˜å¸ƒå±€ï¼Œç¡®ä¿èŠ‚æŒ‰é¡µå¯¹é½ã€‚\n- **æ–‡ä»¶å¯¹é½**ï¼šé€‚ç”¨äº PE æ–‡ä»¶çš„å­˜å‚¨æ ¼å¼ï¼Œç¡®ä¿èŠ‚åœ¨æ–‡ä»¶ä¸­æŒ‰å­—èŠ‚å¯¹é½ã€‚\n\nå› æ­¤ï¼ŒèŠ‚å¯¹é½å’Œæ–‡ä»¶å¯¹é½æ˜¯é’ˆå¯¹ä¸åŒä¸Šä¸‹æ–‡çš„å¯¹é½è¦æ±‚ï¼Œå®ƒä»¬çš„å€¼å’Œä½œç”¨æœ‰æ‰€ä¸åŒã€‚\n\n#### 2.PEæ–‡ä»¶ä¸å†…å­˜æ˜ å°„\n\n**å°±æ˜¯æŠŠ** **PE æ–‡ä»¶** **ä»** **ç¡¬ç›˜ä¸­** **æ”¾åˆ°** **å†…å­˜ä¸­****ï¼Œç„¶å CPU ä» å†…å­˜ä¸­è¯»å–æŒ‡ä»¤å¹¶æ‰§è¡Œã€‚\n\n![](PEæ–‡ä»¶å­¦ä¹ /a.png)\n\n![](PEæ–‡ä»¶å­¦ä¹ /7.png)\n\n**æ–‡ä»¶ä¸­ä½¿ç”¨åç§»ï¼ˆoffsetï¼‰ï¼Œå†…å­˜ä¸­ä½¿ç”¨ VAï¼ˆVirtual Addressï¼Œè™šæ‹Ÿåœ°å€ï¼‰æ¥è¡¨ç¤ºä½ç½®ã€‚**\n\n**VA æŒ‡è¿›ç¨‹è™šæ‹Ÿå†…å­˜çš„ç»å¯¹åœ°å€**ï¼Œ**RVA(Relative Virtual Addressï¼Œç›¸å¯¹è™šæ‹Ÿåœ°å€)æ˜¯æŒ‡ä»æŸåŸºå‡†ä½ç½®ï¼ˆImageBaseï¼‰å¼€å§‹çš„ç›¸å¯¹åœ°å€**ã€‚VA ä¸ RVA æ»¡è¶³ä¸‹é¢çš„æ¢ç®—å…³ç³»ï¼š **RVA + ImageBase = VA**\n\n***************************************************************\nPE å¤´å†…éƒ¨ä¿¡æ¯å¤§å¤šæ˜¯ RVA å½¢å¼å­˜åœ¨ã€‚\nåŸå› åœ¨äºï¼ˆä¸»è¦æ˜¯DLLï¼‰åŠ è½½åˆ°è¿›ç¨‹è™šæ‹Ÿå†…å­˜çš„ç‰¹å®šä½ç½®æ—¶ï¼Œè¯¥ä½ç½®å¯èƒ½å·²ç»åŠ è½½äº†å…¶ä»–çš„ PEæ–‡ä»¶ï¼ˆDLLï¼‰ã€‚\næ­¤æ—¶å¿…é¡»é€šè¿‡é‡å®šå‘ï¼ˆRelocationï¼‰å°†å…¶åŠ è½½åˆ°å…¶ä»–ç©ºç™½çš„ä½ç½®ï¼Œè‹¥ PEå¤´ä¿¡æ¯ä½¿ç”¨çš„æ˜¯ VAï¼Œåˆ™æ— æ³•æ­£å¸¸è®¿é—®ã€‚\nå› æ­¤ä½¿ç”¨ RVA æ¥é‡å®šå‘ä¿¡æ¯ï¼Œå³ä½¿å‘ç”Ÿäº†é‡å®šå‘ï¼Œåªè¦ç›¸å¯¹äºåŸºå‡†ä½ç½®çš„ç›¸å¯¹ä½ç½®æ²¡æœ‰å˜åŒ–ï¼Œå°±èƒ½æ­£å¸¸è®¿é—®åˆ°æŒ‡å®šä¿¡æ¯ï¼Œä¸ä¼šå‡ºç°ä»»ä½•é—®é¢˜ã€‚\n***************************************************************\n\n**å½“ PE æ–‡ä»¶è¢«æ‰§è¡Œæ—¶ï¼ŒPE è£…è½½å™¨ä¼šä¸º \\**è¿›ç¨‹\\** åˆ†é… 4GB çš„ \\**è™šæ‹Ÿåœ°å€ç©ºé—´\\**\\**ï¼ˆ Virtual address spaces å®˜æ–¹æ–‡æ¡£ï¼š\\**\\**https://docs.microsoft.com/zh-tw/windows-hardware/drivers/gettingstarted/virtual-address-spaces\\** \\**ï¼‰\\**ï¼Œç„¶åæŠŠç¨‹åºæ‰€å ç”¨çš„ç£ç›˜ç©ºé—´ä½œä¸ºè™šæ‹Ÿå†…å­˜æ˜ å°„åˆ°è¿™ä¸ª4GBçš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¼šæ˜ å°„åˆ° \\**è™šæ‹Ÿåœ°å€ç©ºé—´\\** ä¸­çš„ 0X400000çš„ä½ç½®ã€‚**\n\n![](PEæ–‡ä»¶å­¦ä¹ /f.png)\n\n### Last\n\nå†™çš„PEæ–‡ä»¶åˆ†æå™¨ğŸŒƒğŸŒƒğŸŒƒ\n\n```C++\n#include <iostream>\n#include <fstream>\n#include <windows.h>\n\nusing namespace std;\n\nvoid PrintDataDirectory(IMAGE_DATA_DIRECTORY dir, const char* name) {\n    cout << name << \" - RVA: 0x\" << hex << dir.VirtualAddress << \", Size: 0x\" << dir.Size << dec << endl;\n}\n\nvoid ParsePEFile(const char* filePath) {\n    // æ‰“å¼€æ–‡ä»¶\n    ifstream file(filePath, ios::binary | ios::in);\n    if (!file) {\n        cerr << \"æ— æ³•æ‰“å¼€æ–‡ä»¶: \" << filePath << endl;\n        return;\n    }\n\n    // è¯»å–DOSå¤´\n    IMAGE_DOS_HEADER dosHeader;\n    file.read(reinterpret_cast<char*>(&dosHeader), sizeof(IMAGE_DOS_HEADER));\n    if (dosHeader.e_magic != IMAGE_DOS_SIGNATURE) {\n        cerr << \"ä¸æ˜¯æœ‰æ•ˆçš„PEæ–‡ä»¶\" << endl;\n        return;\n    }\n\n    // è·³è½¬åˆ°PEå¤´\n    file.seekg(dosHeader.e_lfanew, ios::beg);\n    DWORD signature;\n    file.read(reinterpret_cast<char*>(&signature), sizeof(DWORD));\n\n    if (signature != IMAGE_NT_SIGNATURE) {\n        cerr << \"PEç­¾åæ— æ•ˆ\" << endl;\n        return;\n    }\n\n    // è¯»å–æ–‡ä»¶å¤´\n    IMAGE_FILE_HEADER fileHeader;\n    file.read(reinterpret_cast<char*>(&fileHeader), sizeof(IMAGE_FILE_HEADER));\n\n    // è¯»å–å¯é€‰å¤´ï¼ˆ32ä½/64ä½ï¼‰\n    IMAGE_OPTIONAL_HEADER optionalHeader;\n    file.read(reinterpret_cast<char*>(&optionalHeader), sizeof(IMAGE_OPTIONAL_HEADER));\n\n    cout << \"PEæ–‡ä»¶è§£æï¼š\" << filePath << endl;\n    cout << \"-----------------------------------\" << endl;\n\n    // è¾“å‡ºåŠ è½½åŸºåœ°å€ã€å…¥å£åœ°å€\n    cout << \"åŠ è½½åŸºåœ°å€: 0x\" << hex << optionalHeader.ImageBase << endl;\n    cout << \"å…¥å£åœ°å€: 0x\" << hex << optionalHeader.AddressOfEntryPoint << endl;\n\n    // åˆ¤æ–­æ˜¯å¦å¯ç”¨äº†DEPã€ASLRã€æ§åˆ¶æµä¿æŠ¤ã€SEH\n    bool depEnabled = (optionalHeader.DllCharacteristics & IMAGE_DLLCHARACTERISTICS_NX_COMPAT);\n    bool aslrEnabled = (optionalHeader.DllCharacteristics & IMAGE_DLLCHARACTERISTICS_DYNAMIC_BASE);\n    bool cfGuardEnabled = (optionalHeader.DllCharacteristics & IMAGE_DLLCHARACTERISTICS_GUARD_CF);\n    bool sehEnabled = !(fileHeader.Characteristics & IMAGE_FILE_DLL); // SEHä¸€èˆ¬ç¦ç”¨DLL\n\n    cout << \"DEPå¯ç”¨: \" << (depEnabled ? \"æ˜¯\" : \"å¦\") << endl;\n    cout << \"ASLRå¯ç”¨: \" << (aslrEnabled ? \"æ˜¯\" : \"å¦\") << endl;\n    cout << \"æ§åˆ¶æµä¿æŠ¤å¯ç”¨: \" << (cfGuardEnabled ? \"æ˜¯\" : \"å¦\") << endl;\n    cout << \"SEHå¯ç”¨: \" << (sehEnabled ? \"æ˜¯\" : \"å¦\") << endl;\n\n    // è¾“å‡ºæ•°æ®ç›®å½•é¡¹ä¿¡æ¯\n    cout << \"-----------------------------------\" << endl;\n    cout << \"æ•°æ®ç›®å½•é¡¹:\" << endl;\n\n    PrintDataDirectory(optionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT], \"Export Table\");\n    PrintDataDirectory(optionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_IMPORT], \"Import Table\");\n    PrintDataDirectory(optionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_RESOURCE], \"Resource Table\");\n    PrintDataDirectory(optionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_EXCEPTION], \"Exception Table\");\n    PrintDataDirectory(optionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_SECURITY], \"Security Table\");\n    PrintDataDirectory(optionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_BASERELOC], \"Base Relocation Table\");\n    PrintDataDirectory(optionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_DEBUG], \"Debug Directory\");\n    PrintDataDirectory(optionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_TLS], \"TLS Table\");\n\n    // è¾“å‡ºæ‰€æœ‰èŠ‚çš„åå­—ã€ç›¸å¯¹åç§»ã€å¤§å°\n    cout << \"-----------------------------------\" << endl;\n    cout << \"èŠ‚ä¿¡æ¯:\" << endl;\n\n    file.seekg(dosHeader.e_lfanew + sizeof(DWORD) + sizeof(IMAGE_FILE_HEADER) + fileHeader.SizeOfOptionalHeader, ios::beg);\n    IMAGE_SECTION_HEADER sectionHeader;\n    for (int i = 0; i < fileHeader.NumberOfSections; i++) {\n        file.read(reinterpret_cast<char*>(&sectionHeader), sizeof(IMAGE_SECTION_HEADER));\n        cout << \"èŠ‚å: \" << string(reinterpret_cast<char*>(sectionHeader.Name), 8) << endl;\n        cout << \"ç›¸å¯¹è™šæ‹Ÿåœ°å€: 0x\" << hex << sectionHeader.VirtualAddress << endl;\n        cout << \"å¤§å°: 0x\" << hex << sectionHeader.Misc.VirtualSize << dec << endl;\n        cout << \"-----------------------------------\" << endl;\n    }\n\n    file.close();\n}\n\nint main(int argc, char* argv[]) {\n    if (argc != 2) {\n        cerr << \"ç”¨æ³•: \" << argv[0] << \" <PEæ–‡ä»¶è·¯å¾„>\" << endl;\n        return 1;\n    }\n    ParsePEFile(argv[1]);\n    return 0;\n}\n\n```\n\n```\nä½¿ç”¨å‘½ä»¤:./pe.exe target.exe\n```\n\n","tags":["PE"]},{"title":"Inline_hook","url":"/2024/10/29/Inline-hook/","content":"\n> [!IMPORTANT]\n>\n> inline_hook ä¸€èˆ¬çš„æƒ³æ³•å°±æ˜¯æ›¿æ¢æŸä¸ªå‡½æ•°çš„ç¬¬1ä¸ªæ±‡ç¼–å‘½ä»¤ æ”¹æˆ jmp ç›®æ ‡å‡½æ•°çš„æƒ³æ³•\n>\n> å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯      hook å‡½æ•°ä¸è¢«hookå¤„çš„å‡½æ•° çš„ è°ƒç”¨ç±»å‹ è¦ç›¸åŒ\n\n## 1.x86 ä¸‹çš„Inline hook\n\nx86 ä¸‹ ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨jmp æŒ‡ä»¤  ï¼š 5ä¸ªå­—èŠ‚ ï¼ˆ0xE9 ** ** ** ** ) åé¢å››ä¸ªå­—èŠ‚å°±æ˜¯åç§»åœ°å€\n\n```c++\n#include<stdio.h>\n#include<Windows.h>\nint WINAPI hookMessageBox(\n    _In_opt_ HWND hWnd,\n    _In_opt_ LPCWSTR lpText,\n    _In_opt_ LPCWSTR lpCaption,\n    _In_ UINT uType)\n{\n    printf(\"%s;%s\\n\", lpText, lpCaption);\n    return 0;\n}\nvoid inlinehook(void* target, void* hook_address) {\n    unsigned char jump_hook[10] = { 0 };\n    jump_hook[0] = 0xE9;\n    int offest = (int)hook_address - (int(target) + 5);\n    *(int*)&jump_hook[1] = offest;\n    DWORD oldprotect = 0;\n    VirtualProtect(target, 4096, PAGE_EXECUTE_READWRITE, &oldprotect);\n    memcpy(target, jump_hook, 5);\n    VirtualProtect(target, 4096, PAGE_EXECUTE_READWRITE, &oldprotect);\n}\nint main()\n{\n    inlinehook(MessageBoxA, hookMessageBox);\n    //void* targetFunction = (void*)MessageBoxA;\n    //void* p2 = (void*)hookMessageBox;\n    //printf(\"Address of MessageBoxA: %p\\n\", targetFunction);\n    //printf(\"Address of HookMessageBoxA %p\\n\", p2);\n    MessageBoxA(NULL, \"hello world!\", \"inline_hook\", MB_OK);\n    return 0;\n}\n```\n\n![](Inline-hook/1.png)\n\n**ä¸Šé¢è¿™ç§inline hook æ–¹å¼ ä¼š ä½¿å¾— target å¤„çš„å‡½æ•°ä¸èƒ½æ­£ç¡®æ‰§è¡Œ ï¼Œä¸€èˆ¬æ˜¯ä½¿ç”¨ä¸‹é¢è¿™ç§ hook æ–¹å¼**\n\n![](Inline-hook/3.png)\n\n#### InlineHook.h\n\n```C++\n#pragma once\n\n#include <Windows.h>\n\ntypedef unsigned char byte;\ntypedef signed char int8_t;\ntypedef unsigned char uint8_t;\ntypedef short int16_t;\ntypedef unsigned short uint16_t;\ntypedef int int32_t;\ntypedef unsigned int uint32_t;\ntypedef long long int64_t;\ntypedef unsigned long long uint64_t;\ntypedef uint32_t boolean_t;\n\ntypedef struct _HOOK_STUB\n{\n\tbyte jz[2];\n\tbyte jnz[2];\n\tbyte flag[4];\n\tbyte nop[5];\n\tbyte jmp_handler[5];\n\tbyte origin_code[15];\n\tbyte jmp_origin_fun[5];\n\tbyte flag2[4];\n}HOOK_STUB, *PHOOK_STUB;\n\n\nclass CInlineHook\n{\npublic:\n\tCInlineHook();\n\t~CInlineHook();\n\n\tbool InstallHook(const char* ModuleName, const char* ApiName, void* HandlerAddress);\n\tbool InstallHook(void* TargetAddress, void* HandlerAddress);\n\tbool UninstallHook();\n\n\tvoid* GetOriginFunction() {\n\t\treturn m_OriginFunction;\n\t}\n\t\n\nprotected:\n\t//\n\t// è·å–æ±‡ç¼–æŒ‡ä»¤é•¿åº¦ï¼Œç”¨äºHOOK\n\t//\n\tstatic int InstructLen(void* Address);\n\tstatic const uint8_t c_opinfo[256];\n\n\nprotected:\n\tvoid InitHookStub(PHOOK_STUB HookStub);\n\n\tPHOOK_STUB m_HookStub;\n\tvoid* m_OriginFunction;\n\tvoid* m_TargetAddress;\n\tint m_HookLen;\n};\n\n\n```\n\n#### InlineHook.cpp\n\n```C++\n#include \"InlineHook.h\"\n#include <stdio.h>\n\n/**\n* info structure:\n*\t0x26 means: 6 2 (high-low, low-high)\n*\n* Bit 0:\n*\t1 - has ModR/M\n*\t0 - no ModR/M byte\n* Bit 1~3:\n*\t0 - no imm\n*\t1 - Ib, Jb\n*\t2 - Iw\n*\t3 - Iv, Iz, Jz\n*\t4 - Ib + Iw\n*\n* special cases:\n*\t1. group f6xx, f7xx: nnn = 000,001 -- uses Iz\n*\t2. 9a, ea: Ap (xxxx:xxxxxxxx), 6-byte imm\n*\t3. Ob, Ov: 4-byte long offset\n*/\n\nconst uint8_t CInlineHook::c_opinfo[256] = {\n\t/*        0 1  2 3  4 5  6 7  8 9  A B  C D  E F  */\n\t/*       ---------------------------------------  */\n\t/* 00 */ 0x11, 0x11, 0x26, 0x00, 0x11, 0x11, 0x26, 0x00,\n\t/* 10 */ 0x11, 0x11, 0x26, 0x00, 0x11, 0x11, 0x26, 0x00,\n\t/* 20 */ 0x11, 0x11, 0x26, 0x00, 0x11, 0x11, 0x26, 0x00,\n\t/* 30 */ 0x11, 0x11, 0x26, 0x00, 0x11, 0x11, 0x26, 0x00,\n\t/* 40 */ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t/* 50 */ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t/* 60 */ 0x00, 0x11, 0x00, 0x00, 0x67, 0x23, 0x00, 0x00,\n\t/* 70 */ 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22,\n\t/* 80 */ 0x37, 0x33, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11,\n\t/* 90 */ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t/* A0 */ 0x00, 0x00, 0x00, 0x00, 0x26, 0x00, 0x00, 0x00,\n\t/* B0 */ 0x22, 0x22, 0x22, 0x22, 0x66, 0x66, 0x66, 0x66,\n\t/* C0 */ 0x33, 0x40, 0x11, 0x37, 0x80, 0x40, 0x02, 0x00,\n\t/* D0 */ 0x11, 0x11, 0x22, 0x00, 0x11, 0x11, 0x11, 0x11,\n\t/* E0 */ 0x22, 0x22, 0x22, 0x22, 0x66, 0x02, 0x00, 0x00,\n\t/* F0 */ 0x00, 0x00, 0x00, 0x11, 0x00, 0x00, 0x00, 0x11,\n\t/*        0 1  2 3  4 5  6 7  8 9  A B  C D  E F  */\n\t/*       ---------------------------------------  */\n\t0x11, 0x11, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, /* 0F 00 */\n\t0x11, 0x11, 0x11, 0x11, 0x10, 0x00, 0x00, 0x01, /* 0F 10 */\n\t0x11, 0x11, 0x10, 0x10, 0x11, 0x11, 0x11, 0x11, /* 0F 20 */\n\t0x00, 0x00, 0x00, 0x00, 0x10, 0x10, 0x00, 0x00, /* 0F 30 */\n\t0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, /* 0F 40 */\n\t0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, /* 0F 50 */\n\t0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, /* 0F 60 */\n\t0x33, 0x11, 0x11, 0x10, 0x00, 0x00, 0x11, 0x11, /* 0F 70 */\n\t0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, /* 0F 80 */\n\t0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, /* 0F 90 */\n\t0x00, 0x01, 0x31, 0x00, 0x00, 0x01, 0x31, 0x11, /* 0F A0 */\n\t0x11, 0x11, 0x11, 0x11, 0x00, 0x11, 0x11, 0x11, /* 0F B0 */\n\t0x11, 0x31, 0x33, 0x31, 0x00, 0x00, 0x00, 0x00, /* 0F C0 */\n\t0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, /* 0F D0 */\n\t0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, /* 0F E0 */\n\t0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x10  /* 0F F0 */\n\t/*        0 1  2 3  4 5  6 7  8 9  A B  C D  E F  */\n\t/*       ---------------------------------------  */\n};\n\nenum cpu_mode_t { cm_legacy = -1, cm_compat = 0, cm_64bit = 1 };\n\nint CInlineHook::InstructLen(void* Address)\n{\n\tenum cpu_mode_t cm = cm_compat;\n\tregister uint8_t* p = (uint8_t*)Address;\n\tregister uint8_t b = 0;\n\tregister boolean_t pre_66 = false;\n\tuint8_t info;\n\tregister int tbl_fixup = 0;\n\tregister uint8_t i_info = 0;\n\tregister uint8_t modrm = 0;\n\n\tif (!Address)\n\t\treturn -1;\n\n\twhile (1)\n\t{\n\t\tb = *p++;\n\n\t\tif (b >= 0x40 && b <= 0x4f && cm == cm_64bit)\n\t\t\tcontinue;\n\t\telse if (b == 0x66) {\n\t\t\tpre_66 = true;\n\t\t\tcontinue;\n\t\t}\n\t\telse if (b == 0xf0 || b == 0xf2 || b == 0xf3 ||\n\t\t\tb == 0x26 || b == 0x2e || b == 0x36 ||\n\t\t\tb == 0x3e || b == 0x64 || b == 0x65 ||\n\t\t\tb == 0x67)\n\t\t\tcontinue;\n\t\tbreak;\n\t}\n\n\tif (b == 0x0f) {\n\t\tb = *p++;\n\t\ttbl_fixup = 128;\n\t}\n\n\tinfo = c_opinfo[(b >> 1) + tbl_fixup];\n\tinfo = ((b % 2) ? info : (info >> 4)) & 0x0f;\n\ti_info = (info >> 1) & 7;\n\n\tif (info & 0x01) {\n\t\t/* has modrm */\n\t\tmodrm = *p++;\n\t\tdo {\n\t\t\tregister uint8_t sib = 0;\n\t\t\tboolean_t has_sib = false;\n\t\t\tregister uint8_t tmp = 0;\n\n\t\t\tif ((modrm & 0xc0) == 0xc0)\t/* mod == 3 */\n\t\t\t\tbreak;\n\n\t\t\tif (cm != cm_legacy && (modrm & 0x07) == 4) {\n\t\t\t\thas_sib = true;\n\t\t\t\tsib = *p++;\n\t\t\t}\n\t\t\t/* displacement */\n\t\t\ttmp = has_sib ? sib : modrm;\n\t\t\tif (!(modrm & 0xc0)) {\t/* mod == 00b */\n\t\t\t\tif ((tmp & 0x07) == 5)\n\t\t\t\t\tp += (cm == cm_legacy) ? 2 : 4;\n\t\t\t}\n\t\t\telse if ((modrm & 0xc0) == 0x40) {\t/* mod == 01b */\n\t\t\t\t++p;\n\t\t\t}\n\t\t\telse {\t/* mod == 0x10b */\n\t\t\t\tp += (cm == cm_legacy) ? 2 : 4;\n\t\t\t}\n\t\t} while (0);\n\t}\n\n\t/* special cases */\n\tdo\n\t{\n\t\tregister uint8_t tmp = (modrm & 0x38) >> 3;\t/* nnn */\n\t\tif (tmp == 0 || tmp == 1) {\n\t\t\tif (b == 0xf6)\n\t\t\t\ti_info |= 1;\n\t\t\telse if (b == 0xf7)\n\t\t\t\ti_info |= 3;\t/* Iz */\n\t\t}\n\t\tif (b == 0x9a || b == 0xea)\t/* Ap */\n\t\t\tp += 6;\n\t\tif (b >= 0xa0 && b <= 0xa3)\n\t\t\tp += 4;\n\n\t} while (0);\n\n\t/* take care of immediate value */\n\tswitch (i_info) {\n\tcase 0:\tbreak;\n\tcase 1:\t++p; break;\n\tcase 2:\tp += 2;\tbreak;\n\tcase 3:\tp += pre_66 ? 2 : 4; break;\n\tcase 4:\tp += 3;\tbreak;\n\t}\n\n\treturn (int)(p - (uint8_t*)Address);\n}\n\n\n\nCInlineHook::CInlineHook()\n{\n\tm_HookStub = NULL;\n\tm_OriginFunction = NULL;\n\tm_TargetAddress = NULL;\n\tm_HookLen = 0;\n}\n\n\nCInlineHook::~CInlineHook()\n{\n\tif (m_HookStub)\n\t{\n\t\tdelete m_HookStub;\n\t\tm_HookStub = NULL;\n\t}\n}\n\nvoid CInlineHook::InitHookStub(PHOOK_STUB HookStub)\n{\n\tif (HookStub == NULL)\n\t{\n\t\treturn;\n\t}\n\n\tZeroMemory(HookStub, sizeof(HOOK_STUB));\n\tHookStub->jz[0] = 0x74;\n\tHookStub->jz[1] = 0x06;\n\tHookStub->jnz[0] = 0x75;\n\tHookStub->jnz[1] = 0x04;\n\tmemcpy(HookStub->flag, \"xuan\", sizeof(HookStub->flag));\n\tmemset(HookStub->nop, 0x90, sizeof(HookStub->nop));\n\tHookStub->jmp_handler[0] = 0xE9;\n\tmemset(HookStub->origin_code, 0x90, sizeof(HookStub->origin_code));\n\tHookStub->jmp_origin_fun[0] = 0xE9;\n\tmemcpy(HookStub->flag2, \"yuan\", sizeof(HookStub->flag2));\n}\n\nbool CInlineHook::InstallHook(const char* ModuleName, const char* ApiName, void* HandlerAddress)\n{\n\tHMODULE hModule = NULL;\n\tvoid* targetAddress = NULL;\n\tbool bRet = false;\n\n\tdo \n\t{\n\t\thModule = GetModuleHandleA(ModuleName);\n\t\tif (!hModule)\n\t\t\tbreak;\n\n\t\ttargetAddress = GetProcAddress(hModule, ApiName);\n\t\tif (!targetAddress)\n\t\t\tbreak;\n\n\t\tbRet = InstallHook(targetAddress, HandlerAddress);\n\n\t} while (false);\n\n\treturn bRet;\n}\n\nbool CInlineHook::InstallHook(void* TargetAddress, void* HandlerAddress)\n{\n\tDWORD OldPageProperty = 0;\n\n\tif (TargetAddress == NULL || HandlerAddress == NULL || m_HookStub)\n\t{\n\t\treturn false;\n\t}\n\n\t//\n\t// è®¡ç®—è¦HOOKçš„å­—èŠ‚é•¿åº¦\n\t//\n\tint hook_len = 0;\n\tuint8_t* start_address = (uint8_t*)TargetAddress;\n\twhile (hook_len < 5)\n\t{\n\t\tint instruct_len = InstructLen(start_address);\n\t\tif (instruct_len <= 0 || instruct_len >= 10)\n\t\t\tbreak;\n\n\t\thook_len += instruct_len;\n\t\tstart_address += instruct_len;\n\t}\n\n\t//\n\t// åˆ†é…ä¸­é—´è·³æŒ‡ä»¤åŒºï¼Œå¹¶è®¾ç½®å¯æ‰§è¡Œå±æ€§\n\t//\n\tm_HookStub = new HOOK_STUB();\n\tif (m_HookStub == NULL)\n\t{\n\t\treturn false;\n\t}\n\tif (!VirtualProtect(m_HookStub, sizeof(HOOK_STUB), PAGE_EXECUTE_READWRITE, &OldPageProperty))\n\t{\n\t\tdelete m_HookStub;\n\t\tm_HookStub = NULL;\n\t\treturn false;\n\t}\n\n\t//\n\t// å‡†å¤‡hookä¸­é—´è·³è½¬æŒ‡ä»¤\n\t//\n\tInitHookStub(m_HookStub);\n\tmemcpy(m_HookStub->origin_code, TargetAddress, hook_len);\n\t*((unsigned long *)(&m_HookStub->jmp_handler[1])) = (unsigned long)HandlerAddress - ((unsigned long)&m_HookStub->jmp_handler + 5);\n\t*((unsigned long *)(&m_HookStub->jmp_origin_fun[1])) = ((unsigned long)TargetAddress + hook_len) - ((unsigned long)&m_HookStub->jmp_origin_fun + 5);\n\n\n\t//\n\t// å‡†å¤‡Hookç›®æ ‡å…¥å£è·³è½¬æŒ‡ä»¤\n\t//\n\tbyte jmp_entry[20] = { 0 };\n\tmemset(jmp_entry, 0x90, sizeof(jmp_entry));\n\tjmp_entry[0] = 0xE9;\n\t*((unsigned long*)(&jmp_entry[1])) = (unsigned long)m_HookStub - ((unsigned long)TargetAddress + 5);\n\n\t//\n\t// å¼€å§‹å®‰è£…é’©å­\n\t//\n\tOldPageProperty = 0;\n\tVirtualProtect(TargetAddress, hook_len, PAGE_READWRITE, &OldPageProperty);\n\tmemcpy(TargetAddress, jmp_entry, hook_len);\n\tVirtualProtect(TargetAddress, hook_len, OldPageProperty, &OldPageProperty);\n\n\tm_OriginFunction = &m_HookStub->origin_code;\n\tm_TargetAddress = TargetAddress;\n\tm_HookLen = hook_len;\n\treturn true;\n}\n\nbool CInlineHook::UninstallHook()\n{\n\tif (m_HookStub == NULL)\n\t{\n\t\treturn false;\n\t}\n\n\tDWORD OldPageProperty = 0;\n\n\tVirtualProtect(m_TargetAddress, m_HookLen, PAGE_READWRITE, &OldPageProperty);\n\tmemcpy(m_TargetAddress, m_HookStub->origin_code, m_HookLen);\n\tVirtualProtect(m_TargetAddress, m_HookLen, OldPageProperty, &OldPageProperty);\n\n\tdelete m_HookStub;\n\tm_HookStub = NULL;\n\n\treturn true;\n\n}\n```\n\n#### Test.cpp\n\n```C++\n// Test.cpp : å®šä¹‰æ§åˆ¶å°åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ã€‚\n//\n\n#include <Windows.h>\n#include \"InlineHook.h\"\n\n#include <map>\n#include <string>\nusing namespace std;\n\nmap<string, CInlineHook*> hookTable;\n\ntypedef int (WINAPI *PFN_MessageBoxA) (\n\t\t\t\t\t\t  __in_opt HWND hWnd,\n\t\t\t\t\t\t  __in_opt LPCSTR lpText,\n\t\t\t\t\t\t  __in_opt LPCSTR lpCaption,\n\t\t\t\t\t\t  __in UINT uType);\nint WINAPI HookMessageBoxA(\n\t\t\t\t__in_opt HWND hWnd,\n\t\t\t\t__in_opt LPCSTR lpText,\n\t\t\t\t__in_opt LPCSTR lpCaption,\n\t\t\t\t__in UINT uType)\n{\n\tprintf(\"%s: %s\\n\", lpText, lpCaption);\n\n\tCInlineHook* hook = hookTable[\"MessageBoxA\"];\n\n\tPFN_MessageBoxA pfn_MessageBoxA = (PFN_MessageBoxA)hook->GetOriginFunction();\n\n\tpfn_MessageBoxA(hWnd, lpText, lpCaption, uType);\n\n\treturn 0;\n}\n\nint _tmain(int argc, _TCHAR* argv[])\n{\n\n    CInlineHook hook;\n\t\n    hook.InstallHook(\"user32.dll\", \"MessageBoxA\", HookMessageBoxA);\n\thookTable.insert(pair<string, CInlineHook*>(\"MessageBoxA\", &hook));\n    \n\tMessageBoxA(NULL, \"this is my Blog!\", \"@Xhani\", MB_OK);\n\thookTable[\"MessageBoxA\"]->UninstallHook();\n\treturn 0;\n}\n```\n\n**æ­¤hook æ–¹æ³•ä¸ä¼š å½±å“åŸå‡½æ•°çš„æ­£ç¡® æ‰§è¡Œ**\n\n![](Inline-hook/4.png)\n\n###### *Todo1.ç¼–ç¨‹å®ç°HOOK WriteFile è¿™ä¸ªWindows APIï¼Œå®ç°æ¯æ¬¡è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œåœ¨å†™å…¥çš„æ•°æ®åé¢å¢åŠ ä¸€ä¸ªå­—ç¬¦ä¸²:\"xhani!!!\"ã€‚ç„¶åç¨‹åºé‡Œå°è¯•æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶å†™å…¥ä¸€äº›æ•°æ®ï¼Œæœ€åæ‰“å¼€æ–‡ä»¶çœ‹çœ‹æ˜¯å¦æœ‰è¿™ä¸ªå­—ç¬¦ä¸²å†…å®¹ã€‚*\n\n#### Todo1.cpp\n\n###### 1.æ–¹æ³•ä¸€\n\n```C++\n// Todo1.cpp : å®šä¹‰æ§åˆ¶å°åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ã€‚\n//\n#include <Windows.h>\n#include \"InlineHook.h\"\n#include<string.h>\n\n#include <map>\n#include <string>\nusing namespace std;\n\nmap<string, CInlineHook*> hookTable;\n\ntypedef\nBOOL\n(WINAPI* PFN_WriteFile)(\n\t_In_ HANDLE hFile,\n\t_In_reads_bytes_opt_(nNumberOfBytesToWrite) LPCVOID lpBuffer,\n\t_In_ DWORD nNumberOfBytesToWrite,\n\t_Out_opt_ LPDWORD lpNumberOfBytesWritten,\n\t_Inout_opt_ LPOVERLAPPED lpOverlapped);\n\nBOOL\nWINAPI\nHookWriteFile(\n\t_In_ HANDLE hFile,\n\t_In_reads_bytes_opt_(nNumberOfBytesToWrite) LPCVOID lpBuffer,\n\t_In_ DWORD nNumberOfBytesToWrite,\n\t_Out_opt_ LPDWORD lpNumberOfBytesWritten,\n\t_Inout_opt_ LPOVERLAPPED lpOverlapped\n)\n{\n\tCInlineHook* hook = hookTable[\"WriteFile\"];\n\n\tconst char  str[] = \"Xhani!!!\";\n\tsize_t len = strlen(str) + nNumberOfBytesToWrite;\n\tchar *newbuffer=(char *)malloc(len+1);\n\tif (newbuffer == NULL) return false;\n\tmemcpy(newbuffer,lpBuffer,nNumberOfBytesToWrite);\n\tmemcpy(newbuffer+nNumberOfBytesToWrite-1, str, strlen(str)+1);\n\tnNumberOfBytesToWrite += strlen(str);\n    \n\tPFN_WriteFile pfn_WriteFile = (PFN_WriteFile)hook->GetOriginFunction();\n\t\n\tpfn_WriteFile(hFile, newbuffer, nNumberOfBytesToWrite, lpNumberOfBytesWritten, lpOverlapped);\n\treturn true;\n}\n\n\nint _tmain(int argc, _TCHAR* argv[])\n{\n\tHANDLE hFile = CreateFile(\n\t\tL\"example.txt\",            // æ–‡ä»¶å\n\t\tGENERIC_WRITE,           // å†™å…¥è®¿é—®æƒé™\n\t\t0,                       // ä¸å…±äº«\n\t\tNULL,                    // é»˜è®¤å®‰å…¨æ€§\n\t\tCREATE_ALWAYS,          // å¦‚æœæ–‡ä»¶å­˜åœ¨åˆ™è¦†ç›–\n\t\tFILE_ATTRIBUTE_NORMAL,   // æ™®é€šæ–‡ä»¶\n\t\tNULL                     // æ— æ¨¡æ¿æ–‡ä»¶\n\t);\n\tCInlineHook hook;\n\thook.InstallHook(\"kernel32.dll\", \"WriteFile\", HookWriteFile);\n\n\thookTable.insert(pair<string, CInlineHook*>(\"WriteFile\", &hook));\n\t\n\tchar buffer[]=\"1112211213\";\n\t//fgets(buffer, sizeof(buffer), stdin);\n\tDWORD bytesWritten;\n\n\tWriteFile(hFile, buffer,sizeof(buffer),&bytesWritten,NULL);\n\t\n\thookTable[\"WriteFile\"]->UninstallHook();\n\tCloseHandle(hFile);\n\treturn 0;\n}\n```\n\n###### 2.æ–¹æ³•äºŒ\n\n```C++\n// ä½¿ç”¨backup  æ‹·è´ä¿®æ”¹å¤„çš„æŒ‡ä»¤\n#include<windows.h>\n#include<stdio.h>\n#include<stdlib.h>\n#include<string.h>\n\nvoid* Backup;\n#define BUFFER_SIZE  1024\n\nvoid inline_hook(void* target, void* hook_address, void* Backup);\nvoid uninstall_hook(void* target, void* backup);\n\nBOOL WINAPI hookWriteFile(\n     HANDLE hFile,\n    LPCVOID lpBuffer,\n     DWORD nNumberOfBytesToWrite,\n     LPDWORD lpNumberOfBytesWritten,\n     LPOVERLAPPED lpOverlapped\n)\n{\n    uninstall_hook(WriteFile,Backup);\n    \n    char str[] = \"Xhani!!!!!\";\n    size_t NewSize = strlen(str) + nNumberOfBytesToWrite;\n    char* buffer = (char*)malloc(NewSize+1);\n    if (buffer == NULL) return false;\n    memcpy(buffer,lpBuffer ,nNumberOfBytesToWrite);\n    memcpy(buffer + nNumberOfBytesToWrite, str,strlen(str)+1);\n    nNumberOfBytesToWrite += strlen(str);\n    \n    bool success = WriteFile(hFile, buffer, nNumberOfBytesToWrite, lpNumberOfBytesWritten, lpOverlapped);\n    \n    inline_hook(WriteFile,hookWriteFile,Backup);//  å®‰è£…é’©å­ï¼Œç¡®ä¿ä¸‹æ¬¡æ˜¯è°ƒç”¨åˆ°é’©å­\n    return success;\n}\nvoid inline_hook(void* target, void* hook_address,void *Backup)\n{\n    unsigned char jump_Code[10] = { 0 };\n    jump_Code[0] = 0xE9;\n    int offest = (int)hook_address - (int)target - 5;\n    *(int*)&jump_Code[1] = offest;\n    DWORD oldproperty = 0;\n    VirtualProtect(target, sizeof(jump_Code), PAGE_EXECUTE_READWRITE, &oldproperty);\n    memcpy(Backup, target, 5);\n    memcpy(target, jump_Code, 5);\n    VirtualProtect(target, sizeof(jump_Code), oldproperty, &oldproperty);\n    return;\n}\n\nvoid uninstall_hook(void* target, void* backup) {\n    DWORD oldproperty = 0;\n    VirtualProtect(target, 4096, PAGE_EXECUTE_READWRITE, &oldproperty);\n    memcpy(target, backup, 5);\n    VirtualProtect(target, 4096, oldproperty, &oldproperty);\n    return;\n}\nint main()\n{\n    HANDLE hFile = CreateFile(\n        L\"example.txt\",            // æ–‡ä»¶å\n        GENERIC_WRITE,           // å†™å…¥è®¿é—®æƒé™\n        0,                       // ä¸å…±äº«\n        NULL,                    // é»˜è®¤å®‰å…¨æ€§\n        CREATE_ALWAYS,          // å¦‚æœæ–‡ä»¶å­˜åœ¨åˆ™è¦†ç›–\n        FILE_ATTRIBUTE_NORMAL,   // æ™®é€šæ–‡ä»¶\n        NULL                     // æ— æ¨¡æ¿æ–‡ä»¶\n    );\n    Backup = malloc(5);\n    if (hFile != INVALID_HANDLE_VALUE) {\n        DWORD bytesWritten; // å®é™…å†™å…¥çš„å­—èŠ‚æ•°\n        char buffer[] = \"123456\";\n        inline_hook(WriteFile, hookWriteFile,Backup);\n        WriteFile(hFile, buffer, strlen(buffer), &bytesWritten, NULL);\n    }\n    CloseHandle(hFile);\n    free(Backup);\n    return 0;\n}\n```\n\n\n\n## 2.x64 ä½ä¸‹çš„Inline hook\n\n#### éœ€è¦æ³¨æ„çš„æ˜¯x64 ä¸‹çš„ jmp æŒ‡ä»¤å®é™…æ˜¯ 14ä¸ªå­—èŠ‚(<u>é—´æ¥è·³è½¬</u>)  ï¼š  jmpæŒ‡ä»¤(FF 25)+ offest1(4å­—èŠ‚)+0ffest2(8å­—èŠ‚)  [å› ä¸º64ä½ä¸‹å¯»å€æ›´æ…¢] \n\n> [!NOTE]\n>\n> **é¦–å…ˆæ˜¯è®¡ç®—å‡º  jmp + offset1 çš„åœ°å€p1 ,ç„¶åå¯»å€åˆ°p1å¤„ï¼Œåœ¨è®¡ç®—å‡ºp1+offest2 ,å³ä¸ºç›®æ ‡åœ°å€**\n\n\n\n```c++\n#include<stdio.h>\n#include<Windows.h>\nvoid sh() {\n    printf(\"true\");\n    return;\n}\nvoid sa()\n{\n    printf(\"false\");\n    return;\n}\nvoid inlinehook(__int64* target, __int64* hook_address) {\n    char jump_hook[14] = {0xFF,0x25,00,00,00,00,00,00,00,00,00,00,00,00 };\n    __int64* p = (_int64*)&hook_address;\n    memcpy(jump_hook + 6,p , sizeof(void*));\n \t//char jump_hook[] = {0xFF,0x25,0x01,00,00,00,00,00,00,00,00,00,00,00,00 };\n \t//__int64* p = (_int64*)&hook_address;\n \t//memcpy(jump_hook + 7,p , sizeof(void*));\n    DWORD oldprotect = 0;\n    VirtualProtect(target, sizeof(jump_hook), PAGE_EXECUTE_READWRITE, &oldprotect);\n    memcpy(target, jump_hook, sizeof(jump_hook));\n    VirtualProtect(target, sizeof(jump_hook), oldprotect, &oldprotect);\n    return;\n}\nint main()\n{\n    inlinehook((__int64 *)sa,(_int64 *)sh);\n    sa();\n    return 0;\n}\n```\n\n![](Inline-hook/2.png)\n\n\n\n","tags":["hook"]},{"title":"å¸¸è§æ±‡ç¼–","url":"/2024/09/14/deassembly-md/","content":"\n# if_else:\n\n```\n\t\tcmp a,b\n\t\tje 0x0001\n\t\tæ“ä½œ2 Yes\n\t\tjmp 0x0002\n0x0001:\tæ“ä½œ3 NO\n0x0002:\n```\n\n![](deassembly-md/image-20240914194223239.png)\n\n# switch case:\n\n```\n\t\tæ“ä½œ1\n\t\tcmp  a,400\n\t\tjg 0x000000\n\t\tcmp a,400\n\t\tje 0x000001\n\t\tcmp a,300\n\t\tje 0x00002\n\t\tcmp a,200\n\t\tje 0x0003\n\t\tjmp 0x0004           \n\t\tæ“ä½œ2  \n\t\tjmp 0x0004         //å®é™…ä¸Šæ˜¯æœ‰break;\n\t\tæ“ä½œ3\n\t\tjmp 0x0004 \n\t\tæ“ä½œ4\n\t\tjmp 0x0004\n\t\tæ“ä½œ5\n0x0004:\n```\n\n![](deassembly-md/image-20240914194329734.png)\n\n# while()\n\n```\n0x0000: cmp a,100\n      \tjle 0x00001\n\t\tæ“ä½œ\n\t\tjmp 0x0000\n0x00001:\n```\n\n![](deassembly-md/image-20240914195237570.png)\n\n# do  while()\n\n```\n0x00001:æ“ä½œ\n\t\tcmp a,100\n\t\tjle  0x00001\n```\n\n![](deassembly-md/image-20240914195647559.png)\n\n# for()\n\n```\n\t\tmov dowrd ptr[ebp-8],1\n\t\tjmp 0x00001\n0x00003:æ“ä½œ\n       \tadd/sub/mul/div ecx,dowrd ptr[ebp-8]\n0x00001:cmp ecx,dowrd ptr[ebp-8]\n\t\tjg 0x00002\n\t\tæ“ä½œ\n\t\tjmp 0x00003\n0x00002:\n```\n\n![](deassembly-md/image-20240914195836157.png)\n","tags":["æ±‡ç¼–"]},{"title":"ç½‘ç»œç©ºé—´æœç´¢å¼•æ“2","url":"/2024/05/23/ç½‘ç»œç©ºé—´æœç´¢å¼•æ“2/","content":"\n# shodan\n\nä½¿ç”¨æ–‡æ¡£ï¼šhttps://xz.aliyun.com/t/2070?time__1311=n4%2BxnieDqmqqB7DuDBTroGkYDkQG8Y%2FRB%2F%2BeD&alichlgref=https%3A%2F%2Fwww.google.com%2F\n\nshodançš„æŸ¥è¯¢å¿«æ·è¯­å¥ï¼šhttps://github.com/jakejarvis/awesome-shodan-queries\n\nshodançš„pyè„šæœ¬ï¼šhttps://github.com/random-robbie/My-Shodan-Scripts\n\n## 1.shodan.io\n\n**shodanæœç´¢ä½¿ç”¨æ–‡æ¡£ï¼šhttps://help.shodan.io/the-basics/search-query-fundamentals**\n\nkaliä¸Šå†…ç½®shodan\n\n## 2.shodançš„åŠŸèƒ½ï¼š\n\n- åœ°å›¾\n- ç›‘æ§\n- æˆªå›¾\n- è¿‡æ»¤å™¨\n\n## 3.shodanå¸¸è§å‘½ä»¤ï¼š\n\n```\nshodan host 172.67.167.88\n```\n\n```\nshodan count apache\n```\n\n```\nshodan stats port:445 SMB\n```\n\n","tags":["web"]},{"title":"ç½‘ç»œç©ºé—´æœç´¢å¼•æ“1","url":"/2024/05/23/ç½‘ç»œç©ºé—´æœç´¢å¼•æ“1/","content":"\n## 1.ä»€ä¹ˆæ˜¯ç½‘ç»œç©ºé—´ï¼šCyber space\n\næœç´¢å¼•æ“ï¼šgooleè¯ç”Ÿâ€”â€”â€”â€”ç½‘é¡µ\n\nå‘å±•ï¼šå›¾ç‰‡ éŸ³ä¹ å£°éŸ³\n\nè¿›ä¸€æ­¥ï¼š\n\n| ç½‘ç»œç³»ç»Ÿ | ç½‘ç»œè®¾å¤‡                 | å·¥ä¸šç³»ç»Ÿ                 |\n| -------- | ------------------------ | ------------------------ |\n| CDN      | æ‰‹æœº                     | äº¤é€šä¿¡å·ç¯  å…¬å›­æ§åˆ¶ç³»ç»Ÿ |\n| IDS      | å¹³æ¿                     | æ ¸ç”µç«™                   |\n| CMS      | äº¤æ¢æœº è·¯ç”±å™¨ ç½‘ç»œæ‘„åƒå¤´ | åŠ æ²¹ç«™                   |\n| åŠå…¬è½¯ä»¶ | ç§äººç½‘ç›˜                 | ç”µç½‘                     |\n| æ•°æ®åº“   | æ‰“å°æœº  ATM æœºå™¨äºº       | ä¼ä¸šå¤§å±å¹•               |\n\n## 2.ç½‘ç»œç©ºé—´æœç´¢å¼•æ“ï¼š\n\n##### æ€ä¹ˆæ‰«æï¼š1.ç”¨ç½‘ç»œå·¥å…·ï¼šzmap nmap  2.æ–¹å¼ï¼šIPåº“ æšä¸¾\n\næ€ä¹ˆæ ‡è¯†è®¾å¤‡ï¼š\n\n- ip:åŸŸå\n\n- MAC\t\n\n- çˆ¬è™«ï¼šurl\n\n- å¼€æ”¾ç³»ç»Ÿ\n- ç‰©ç†åœ°å€\n- æ“ä½œç³»ç»Ÿ\n- è®¾å¤‡ç±»å‹\n\n## 3.å®è¡Œå¨èƒåœ°å›¾ï¼šfireeye\n\n## 4.å®‰å…¨æ€§\n","tags":["web"]},{"title":"Google_hacking","url":"/2024/05/23/Google-hacking/","content":"\n## 1.è¯­æ³•å·¥å…·ï¼špdfæ–‡æ¡£ï¼šhttps://web.archive.org/web/20140822191407/http://www.boris-koch.de/wp-content/uploads/2011/01/Liste-Google-Hacking.pdf\n\n\n\n## 2.ä¸€äº›è¿ç®—ç¬¦ï¼š\n\n**å®Œå…¨åŒ¹é…:**\n\n```\n\"ç½‘ç»œå®‰å…¨\"\n```\n\n**ä»»æ„è¯è¯­ï¼š**\n\n```\n1 or 2\n```\n\n**ä¸åŒ…å«ï¼š**\n\n```\nburp_suite - xxx\n```\n\n**æ•°å­—èŒƒå›´ï¼š**\n\n```\nnumber..number\n```\n\n## 3.é«˜çº§è¯­æ³•\n\n**1.åªæœç´¢æŸä¸ªç½‘ç«™çš„å†…å®¹ï¼š**\n\n```\nsite:zhihu.com\n```\n\n**2.ç½‘é¡µå†…å®¹åŒ…æ‹¬ï¼š**\n\n```\nallintext:Powered by Discuz\nintextï¼šPowered by Discuz\n```\n\n###### æ ‡é¢˜ï¼šæ˜¯htmlç½‘é¡µæ ‡ç­¾çš„æ ‡é¢˜\n\n **3.æ ‡é¢˜å‡ºç°ï¼š**\n\n```\nintitleï¼š\nallintitle:\n```\n\n**4.urlåœ°å€åŒ…æ‹¬ï¼š**\n\n```\nallinurl:admin.php\ninurl:index.php?id=1\n```\n\n**5.æ–‡ä»¶ç±»å‹ï¼š**\n\n```\nfiletypeï¼špdf\n```\n\n**6.index of**\n\n```\nintitle:index of\n```\n\n##  4.googleè¯­æ³•æ•°æ®åº“ï¼š\n\nhttps://www.exploit-db.com/google-hacking-database\n\nhttps://github.com/BullsEye0/google_dork_list\n\n## 5.å·¥å…·ï¼š\n\ngithubæœç´¢ï¼šGoogle hcaking \n\nâ€‹\t\t\tGoogle dorks \n"},{"title":"WAF_difference","url":"/2024/05/16/WAF_difference/","content":"\n# WAF:webåº”ç”¨é˜²ç«å¢™\n\n### 1.ä½œç”¨ï¼ˆç®€å•çš„ï¼‰\n\n![image1](WAF_difference/1.png)\n\n### 2.WAFè¯†åˆ«æ€è·¯ï¼š\n\n1.[0xInfection/Awesome-WAF: ğŸ”¥ Web-application firewalls (WAFs) from security standpoint. (github.com)](https://github.com/0xInfection/Awesome-WAF)\n\n2.[CSecGroup/wafid: Wafid identify and fingerprint Web Application Firewall (WAF) products. (github.com)](https://github.com/CSecGroup/wafid)\n\n### 3.å¦‚ä½•è§¦å‘wafæ‹¦æˆªï¼š\n\n##### 1.å·¥å…·ï¼škali:wafw00f\n\n```\nwafw00f https://pinpai.smzdm.com/\n```\n\n```\nnmap www.12306.cn --script=http-waf-detect.nse\n```\n\n**å¿…é¡»æ˜¯åŠ¨æ€åœ°å€**ï¼š\n\n```\nsqlmap -u \"xxx.com?id=1\" --identify-waf\n```\n\n","tags":["web"]},{"title":"CDN_difference","url":"/2024/05/16/CDN-difference/","content":"\n### 1.CDNæ˜¯ä»€ä¹ˆï¼š[CDNå›¾è§£ï¼ˆç§’æ‡‚ + å²ä¸Šæœ€å…¨ï¼‰ - ç–¯ç‹‚åˆ›å®¢åœˆ - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/crazymakercircle/p/14978513.html)\n\n### 2.å¦‚ä½•è·å–CDNèƒŒåçš„çœŸå®ip\n\n1.ping\n\n2.\n\n```\nnslookup åŸŸå\n```\n\n3.è¶…çº§ping\n\n4.Kaliå·¥å…·:lbd\n\n5.å›½å†…ï¼šcdn.chinaz.com\n\nå›½å¤–cdnplanet.com/tools/cdnfinder\n\n6.è„šæœ¬ï¼š\n\nhttps://github.com/boy-hack/w8fuckcdn/\n\nhttps://gitghub.com/3xp10it/xcdn\n","tags":["web"]},{"title":"CMS_judgement","url":"/2024/05/15/CMS-judgement/","content":"\n# CMSçš„æŒ‡çº¹è¯†åˆ«\n\n## 1.è¯†åˆ«å¯¹è±¡ï¼š\n\n#### 1.**CMSä¿¡æ¯**ï¼šå†…å®¹ç®¡ç†ç³»ç»Ÿ\n\n2.å‰ç«¯æŠ€æœ¯ï¼š\n\n3.å¼€å‘è¯­è¨€\n\n4.webæœåŠ¡å™¨\n\n5.åº”ç”¨æœåŠ¡å™¨\n\n6.æ“ä½œç³»ç»Ÿ\n\n#### 7.CDNçš„ä¿¡æ¯\n\n#### 8.WAFä¿¡æ¯\n\n## 2.CMSï¼š\n\nå„ç±»å¼€æºçš„CMSï¼šä¼ä¸šï¼Œåšå®¢ï¼Œè®ºå›ï¼Œé—®ç­”ï¼ŒçŸ¥è¯†ç™¾ç§‘ï¼Œé—¨æˆ·å»ºç«™ï¼Œåœ¨çº¿æ•™è‚²å»ºç«™ï¼Œäººæ‰æ‹›è˜ç½‘ç«™\n\n## 3.CMSè¯†åˆ«æ€è·¯ï¼š\n\n###### 1.ç‰ˆæƒä¿¡æ¯\n\n###### 2.ç‰¹å®šæ–‡ä»¶MD5å€¼:(https://github.com/Lucifer1993/cmsprint/blob/master/cmsprint.json)\n\n###### 3.æŸ¥çœ‹é¡µé¢åŸä»£ç :åˆ†æä»£ç \n\n###### 4.æŸ¥çœ‹ç‰¹å®šæ–‡ä»¶åˆ†æï¼šå¦‚ç½‘ç«™çš„robots .txtæ–‡ä»¶\n\n## 4.CMSå·¥å…·ï¼š\n\n###### 1.kaliå·¥å…·ï¼šwhatweb\n\n```kali\n`whatweb  -v www.coolshell.cn`\n```\n\n\n\n###### 2.æµè§ˆå™¨æ’ä»¶ï¼šWappalyzer,whatruns\n\n###### 3.https://github.com/Tuhinshubhra/CMSeek\n\n###### 4.http://finger.tidesec.com/\n\n","tags":["web"]},{"title":"nampçš„ä½¿ç”¨","url":"/2024/05/14/Use_nmap/","content":"\n# 1.nmapçš„ä½¿ç”¨ï¼š[](https://blog.csdn.net/weixin_49998039/article/details/125242779)\n\n### 1.ç±»åˆ«ï¼š\n\nopen:ç«¯å£å¼€å¯\n\nfiltered:è¢«é˜²ç«å¢™é˜»æ­¢æ‰«æ\n\nclosedï¼šç«¯å£å…³é—­\n\nunfilteredï¼šæ— æ³•ç¡®å®šçš„\n\n### 2.nmapçš„å‚æ•°\n\nnmap -sV:ç‰ˆæœ¬æ£€æµ‹\n\n-PN:ç»•è¿‡pingå‘½ä»¤\n\n-Oï¼šæ“ä½œç³»ç»Ÿæ£€æµ‹ï¼Œ1-6\n\n-Tï¼šè®¾ç½®æ‰«æé€Ÿåº¦\n\n-sPï¼šä¸»æœºå­˜æ´»æ€§\n\n-Ss:SYNæ–¹å¼\n\n-ST:ä¸‰æ¬¡æ¡æ‰‹\n\n-SP:æ²¡æœ‰æ‰«æ\n\n-pn:ğŸˆ²ping\n\n-Su:udpçš„æ•°æ®åŒ…\n\n-sF:FINçš„æ–¹å¼\n\n### 3.èŒƒå›´å†…ï¼š\n\n192.168.1.1-4\n\n### 4.æ³¨æ„å…¶ä»–å·¥å…·çš„ç»“åˆï¼šmasscan:[](https://blog.csdn.net/2302_82189125/article/details/135999466)\n\nfofa.infoï¼Œfofa-viewæ’ä»¶\n\n### 5.å¸¸è§ç«¯å£\n\nThis is a img\n\n![image](Use_nmap/1.png)\n","tags":["web"]},{"title":"ç«¯å£ä¿¡æ¯","url":"/2024/05/10/ç«¯å£ä¿¡æ¯/","content":"\n## 1.ç«¯å£æ‰«æå’Œä»£ç å®ç°ï¼š\n\n1.`windows :netstat -aon|findstr 3306`\n\n`linux:netstat -an|grep 3306`\n\n2.å¯¹ç«¯å£å‘æ•°æ®åŒ…æ‰«ï¼š\n\nå‘½ä»¤ï¼š`wget ip 80`\n\n`telnet ip 80`\n\n`nc -vz ip 445`\n\n3.å·¥å…·\n\næ‰«æä¸»æœºï¼Œç«¯å£ï¼Œæ¢æµ‹æ“ä½œç³»ç»Ÿï¼Œè½¯ä»¶ç‰ˆæœ¬**zenmap**\n\nnmap ä½¿ç”¨æ–‡æ¡£ \n\n**dirsearchè„šæœ¬**\n\n**masscan**\n\n\n\n4.ç«¯å£ç±»å‹ï¼š\n\næ–‡ä»¶å…±äº«ï¼š\n\nè¿œç¨‹è¿æ¥ï¼š\n\nwebåº”ç”¨ï¼š\n\næ•°æ®åº“æœåŠ¡\n\nç½‘è·¯å¸¸è§ç«¯å£\n\nç‰¹æ®ŠæœåŠ¡ç«¯å£\n\n","tags":["web"]},{"title":"ipä¿¡æ¯æ”¶é›†","url":"/2024/05/10/ipä¿¡æ¯æ”¶é›†/","content":"\n# ipä¿¡æ¯æ”¶é›†ï¼š\n\n## 1.DNSç±»å‹\n\n##### 1.æœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼Œæ ¹åŸŸåæœåŠ¡å™¨ï¼Œé¡¶çº§åŸŸåï¼ŒæˆæƒåŸŸå\n\n##### 2.è¿­ä»£æŸ¥è¯¢ï¼Œé€’å½’æŸ¥è¯¢\n\n## 2.ping/nslookup\n\n##### ping:åº”ç”¨å±‚ \n\nå‘½ä»¤ï¼š`nslookup -type=\"MS\" baidu.com`\n\n## 3.IPå½’å±ï¼š\n\n1.ipwhois.cnnic.cn\n\n2.ip138.com\n\n## 4.CDNæœåŠ¡ï¼š\n\n#### è¦æ‰¾åˆ°CDNèƒŒåçš„çœŸå®ip\n\n###### 1.è¶…çº§ping\n\n######  2.å†å²DNS:dnshistory  \n\n###### 3.é€šè¿‡å­åŸŸå\n\n###### 4.å›½å¤–ä¸»æœºè§£æ:dnscheck,webpagetest.org\n\n###### 5.é‚®ä»¶ï¼ŒSSLè¯ä¹¦ï¼Œæ‰‹æœºæŠ“åŒ…\n\n\n\n\n\n","tags":["web"]},{"title":"åŸŸåä¿¡æ¯æ”¶é›†","url":"/2023/11/17/åŸŸåä¿¡æ¯/","content":"\n#   1.åŸŸåä¿¡æ¯\n\n## 1.åˆ†ç±»ï¼š\n\nå›½é™…åŸŸåï¼šcom,net,org,gov,edu,mil,int\n\nå›½åˆ«ï¼šcn,uk,us,\n\næ–°é¡¶çº§åŸŸåï¼šbiz,name,pro,info,coop,museum\n\n## 2.åŸŸåè”ç³»äººä¿¡æ¯:å§“åï¼Œé‚®ç®±ï¼Œæ‰‹æœºå·\n\n### 1.åŸŸåæŸ¥è¯¢\n\n#### 1.é˜¿é‡Œäº‘\n\n#### 2.whois.chinaz.com\n\n#### 3.whoissoft.com\n\n#### 4.whois.cnnic.cn\n\n#### 5.kailå‘½ä»¤\n\n```ABAP\nwhois åŸŸå\n```\n\n### 2.åŸŸååå·®ï¼š\n\n#### 1.whois.chinaz.com\n\n### 3.å¤‡æ¡ˆä¿¡æ¯\n\n#### 1.beian.miit.gov.cn\n\n#### 2.beian88.com\n\n#### 3.å¤©çœ¼æŸ¥\n\n### 3.å­åŸŸåï¼š\n\n#### 1.ä¾‹å¦‚ï¼šnews.baidu.com\n\n**å·¥å…·ï¼š1.Layer   2. subDomainsBrute**\n\n**å­—å…¸æ‹†è§£ï¼Œæšä¸¾**\n\n### DNSæœåŠ¡ï¼š\n\nDNSæœåŠ¡å™¨\n1.ä¸»æœºè®°å½•\n\nè®°å½•ç±»å‹ï¼šA:æŒ‡å®šipåœ°å€ï¼ŒCNAMEï¼šå°†ä¸€ä¸ªåŸŸåæŒ‡å‘å¦ä¸€ä¸ªåŸŸåï¼ŒAAAAï¼ŒMXï¼ŒTXTï¼ŒNSï¼šåŸŸåæœåŠ¡å™¨è®°å½•\n\n2.æŸ¥è¯¢ï¼š\n\n[åŸŸåè§£ææŸ¥è¯¢(A/Txt/Cname/Mx/Srv/Aaaa...) (dbcha.cn)](http://dbcha.cn/)\n\nnetcraft\n\njsons.cn\n\nkailå·¥å…·ï¼šmaltego\n\n","tags":["web"]}]